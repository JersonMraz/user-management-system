import{a as k}from"./chunk-HPUE7TLN.js";import{a as N}from"./chunk-MLL72OG6.js";import{$ as U,A as u,B as h,Ba as se,C as _,Ca as F,D as p,Ea as L,F as d,G as v,Ga as le,H as M,I as j,K as $,P as C,R as G,S,T as O,U as Q,W as w,X as T,Y as P,Z as R,_ as z,a as B,ga as H,ha as b,ia as J,j as f,ja as K,l as q,la as W,ma as X,n as I,na as Y,o as A,oa as Z,p as x,pa as ee,q as y,qa as te,ra as ie,s as o,sa as ne,t as g,ta as re,u as m,ua as oe,v as s,xa as ae,y as i,z as n,za as de}from"./chunk-JYF5EYNH.js";var be=(t,l,e)=>({"badge bg-warning":t,"badge bg-success":l,"badge bg-danger":e});function xe(t,l){t&1&&(i(0,"th"),d(1,"Actions"),n())}function ye(t,l){t&1&&(i(0,"tr")(1,"td",12)(2,"div",13)(3,"span",14),d(4,"Loading..."),n()()()())}function he(t,l){t&1&&(i(0,"tr")(1,"td",12),u(2,"i",15)(3,"br"),i(4,"span",16),d(5,"No requests found"),n()()())}function Ce(t,l){if(t&1&&(i(0,"li"),d(1),n()),t&2){let e=l.$implicit;o(),j(" ",e.description," (",e.quantity,") ")}}function Se(t,l){if(t&1){let e=h();i(0,"button",27),_("click",function(){x(e);let r=p(2).$implicit,c=p();return y(c.approveRequest(r.id))}),u(1,"i",28),i(2,"span"),d(3,"Approve"),n()()}}function Ee(t,l){if(t&1){let e=h();i(0,"button",29),_("click",function(){x(e);let r=p(2).$implicit,c=p();return y(c.rejectRequest(r.id))}),u(1,"i",30),i(2,"span"),d(3,"Reject"),n()()}}function qe(t,l){if(t&1){let e=h();i(0,"td")(1,"div",22),m(2,Se,4,0,"button",23)(3,Ee,4,0,"button",24),i(4,"button",25),_("click",function(){x(e);let r=p().$implicit,c=p();return y(c.deleteRequest(r.id))}),u(5,"i",26),i(6,"span"),d(7,"Delete"),n()()()()}if(t&2){let e=p().$implicit;o(2),s("ngIf",e.status==="Pending"),o(),s("ngIf",e.status==="Pending")}}function Ie(t,l){if(t&1&&(i(0,"tr",17)(1,"td"),d(2),S(3,"titlecase"),n(),i(4,"td"),d(5),n(),i(6,"td")(7,"span",18),d(8),n()(),i(9,"td"),d(10),i(11,"small",19),d(12),n()(),i(13,"td")(14,"ul",20),m(15,Ce,2,2,"li",21),n()(),i(16,"td"),d(17),S(18,"date"),n(),m(19,qe,8,2,"td",10),n()),t&2){let e=l.$implicit,a=p();o(2),v(O(3,10,e.type)),o(3),v(e.description),o(2),s("ngClass",G(15,be,e.status==="Pending",e.status==="Approved",e.status==="Rejected")),o(),M(" ",e.status," "),o(2),j(" ",e.employee==null?null:e.employee.firstName," ",e.employee==null?null:e.employee.lastName," "),o(2),v(e.employee==null?null:e.employee.position),o(3),s("ngForOf",e.items),o(2),v(Q(18,12,e.createdAt,"medium")),o(2),s("ngIf",a.isAdmin)}}var me=(()=>{class t{requestService;accountService;requests=[];loading=!1;isAdmin=!1;constructor(e,a){this.requestService=e,this.accountService=a,this.isAdmin=this.accountService.accountValue?.role==="Admin"}ngOnInit(){if(this.loading=!0,this.isAdmin)this.requestService.getAll().pipe(f()).subscribe(e=>{this.requests=e,this.loading=!1});else{let e=this.accountService.accountValue?.id;e&&this.requestService.getByEmployeeId(Number(e)).pipe(f()).subscribe(a=>{this.requests=a,this.loading=!1})}}deleteRequest(e){confirm("Are you sure you want to delete this request?")&&(this.loading=!0,this.requestService.delete(e).pipe(f()).subscribe({next:()=>{this.requests=this.requests.filter(a=>a.id!==e),this.loading=!1},error:a=>{alert("Failed to delete request."),this.loading=!1}}))}approveRequest(e){this.loading=!0,this.requestService.approve(e).pipe(f()).subscribe({next:a=>{let r=this.requests.findIndex(c=>c.id===e);r!==-1&&(this.requests[r]=a),this.loading=!1},error:a=>{alert("Failed to approve request."),this.loading=!1}})}rejectRequest(e){this.loading=!0,this.requestService.reject(e).pipe(f()).subscribe({next:a=>{let r=this.requests.findIndex(c=>c.id===e);r!==-1&&(this.requests[r]=a),this.loading=!1},error:a=>{alert("Failed to reject request."),this.loading=!1}})}static \u0275fac=function(a){return new(a||t)(g(k),g(N))};static \u0275cmp=I({type:t,selectors:[["ng-component"]],decls:30,vars:4,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],["routerLink","add",1,"btn","btn-primary","d-flex","align-items-center","gap-2"],[1,"fas","fa-plus"],[1,"card","shadow-sm"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped","align-middle"],[1,"table-light"],[4,"ngIf"],["class","table-row-hover",4,"ngFor","ngForOf"],["colspan","7",1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"fas","fa-inbox","fa-2x","text-muted","mb-2"],[1,"text-muted"],[1,"table-row-hover"],[3,"ngClass"],[1,"d-block","text-muted"],[1,"list-unstyled","mb-0"],[4,"ngFor","ngForOf"],[1,"btn-group","gap-1"],["class","btn btn-sm btn-success d-flex align-items-center gap-1","title","Approve",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger d-flex align-items-center gap-1","title","Reject",3,"click",4,"ngIf"],["title","Delete",1,"btn","btn-sm","btn-outline-danger","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-trash"],["title","Approve",1,"btn","btn-sm","btn-success","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-check"],["title","Reject",1,"btn","btn-sm","btn-danger","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-times"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),d(3,"Requests"),n(),i(4,"button",3),u(5,"i",4),d(6," Create Request "),n()(),i(7,"div",5)(8,"div",6)(9,"div",7)(10,"table",8)(11,"thead",9)(12,"tr")(13,"th"),d(14,"Type"),n(),i(15,"th"),d(16,"Description"),n(),i(17,"th"),d(18,"Status"),n(),i(19,"th"),d(20,"Employee"),n(),i(21,"th"),d(22,"Items"),n(),i(23,"th"),d(24,"Created"),n(),m(25,xe,2,0,"th",10),n()(),i(26,"tbody"),m(27,ye,5,0,"tr",10)(28,he,6,0,"tr",10)(29,Ie,20,19,"tr",11),n()()()()()()),a&2&&(o(25),s("ngIf",r.isAdmin),o(2),s("ngIf",r.loading),o(),s("ngIf",!r.loading&&r.requests.length===0),o(),s("ngForOf",r.requests))},dependencies:[w,T,P,F,R,z],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600}.badge[_ngcontent-%COMP%]{font-size:.85em;padding:.5em .75em}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem;transition:background .2s,color .2s,box-shadow .2s}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover, .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:focus{box-shadow:0 2px 8px #00000014;z-index:1}.list-unstyled[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.text-muted[_ngcontent-%COMP%]{font-size:.875rem}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .2s}.card[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #e3e6ea}.card-body[_ngcontent-%COMP%]{padding:2rem}.table[_ngcontent-%COMP%]{margin-bottom:0}"]})}return t})();var E=t=>({"is-invalid":t});function Ae(t,l){if(t&1&&(i(0,"option",28),d(1),S(2,"titlecase"),n()),t&2){let e=l.$implicit;s("value",e),o(),v(O(2,2,e))}}function Me(t,l){t&1&&(i(0,"div"),d(1,"Type is required"),n())}function Oe(t,l){if(t&1&&(i(0,"div",29),m(1,Me,2,0,"div",30),n()),t&2){let e=p();o(),s("ngIf",e.f.type.errors.required)}}function we(t,l){if(t&1&&(i(0,"option",28),d(1),n()),t&2){let e=l.$implicit;s("value",e.id),o(),$(" ",e.employeeId," - ",e.firstName," ",e.lastName," (",e.position,") ")}}function Te(t,l){t&1&&(i(0,"div"),d(1,"Employee is required"),n())}function Pe(t,l){if(t&1&&(i(0,"div",29),m(1,Te,2,0,"div",30),n()),t&2){let e=p();o(),s("ngIf",e.f.employeeId.errors.required)}}function Re(t,l){t&1&&(i(0,"div"),d(1,"Description is required"),n())}function Fe(t,l){if(t&1&&(i(0,"div",29),m(1,Re,2,0,"div",30),n()),t&2){let e=p();o(),s("ngIf",e.f.description.errors.required)}}function Ne(t,l){t&1&&(i(0,"div"),d(1,"Description is required"),n())}function ke(t,l){if(t&1&&(i(0,"div",29),m(1,Ne,2,0,"div",30),n()),t&2){let e=p().$implicit;o(),s("ngIf",e.get("description").errors.required)}}function je(t,l){t&1&&(i(0,"div"),d(1,"Quantity is required"),n())}function Le(t,l){t&1&&(i(0,"div"),d(1,"Quantity must be at least 1"),n())}function Ve(t,l){if(t&1&&(i(0,"div",29),m(1,je,2,0,"div",30)(2,Le,2,0,"div",30),n()),t&2){let e=p().$implicit;o(),s("ngIf",e.get("quantity").errors.required),o(),s("ngIf",e.get("quantity").errors.min)}}function De(t,l){if(t&1){let e=h();i(0,"div",31)(1,"div",32)(2,"div",33)(3,"label",34),d(4,"Item Description"),n(),u(5,"input",35),m(6,ke,2,1,"div",11),n(),i(7,"div",36)(8,"label",34),d(9,"Quantity"),n(),u(10,"input",37),m(11,Ve,3,2,"div",11),n(),i(12,"div",38)(13,"button",39),_("click",function(){let r=x(e).index,c=p();return y(c.removeItem(r))}),u(14,"i",40),i(15,"span"),d(16,"Remove"),n()()()()()}if(t&2){let e=l.$implicit,a=l.index,r=p();s("formGroupName",a),o(3),s("for","itemDesc"+a),o(2),s("id","itemDesc"+a)("ngClass",C(9,E,r.submitted&&e.get("description").errors)),o(),s("ngIf",r.submitted&&e.get("description").errors),o(2),s("for","itemQty"+a),o(2),s("id","itemQty"+a)("ngClass",C(11,E,r.submitted&&e.get("quantity").errors)),o(),s("ngIf",r.submitted&&e.get("quantity").errors)}}function Be(t,l){t&1&&u(0,"span",41)}var D=(()=>{class t{formBuilder;route;router;requestService;accountService;employeeService;form;id;isAddMode;loading=!1;submitted=!1;requestTypes=["equipment","leave","resource","other"];employees=[];constructor(e,a,r,c,ce,ue){this.formBuilder=e,this.route=a,this.router=r,this.requestService=c,this.accountService=ce,this.employeeService=ue}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({type:["",b.required],description:["",b.required],employeeId:["",b.required],items:this.formBuilder.array([])}),this.employeeService.getAll().subscribe(e=>{this.employees=e}),this.isAddMode||(this.loading=!0,this.requestService.getById(this.id).pipe(f()).subscribe(e=>{this.form.patchValue(e),e.items&&e.items.forEach(a=>{this.addItem(a)}),this.loading=!1}))}get f(){return this.form.controls}get items(){return this.form.get("items")}addItem(e){let a=this.formBuilder.group({description:[e?.description||"",b.required],quantity:[e?.quantity||1,[b.required,b.min(1)]]});this.items.push(a)}removeItem(e){this.items.removeAt(e)}onSubmit(){this.submitted=!0,!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createRequest():this.updateRequest())}createRequest(){let e=B({},this.form.value);this.requestService.create(e).pipe(f()).subscribe({next:()=>{this.router.navigate(["../"],{relativeTo:this.route})},error:a=>{console.error("Error creating request:",a),this.loading=!1}})}updateRequest(){this.requestService.update(this.id,this.form.value).pipe(f()).subscribe({next:()=>{this.router.navigate(["../"],{relativeTo:this.route})},error:e=>{console.error("Error updating request:",e),this.loading=!1}})}static \u0275fac=function(a){return new(a||t)(g(oe),g(de),g(se),g(k),g(N),g(le))};static \u0275cmp=I({type:t,selectors:[["ng-component"]],decls:48,vars:21,consts:[[1,"container","mt-4"],[1,"card","shadow-sm"],[1,"card-header","bg-white","border-bottom-0","pb-0"],[1,"mb-0"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","typeSelect",1,"form-label"],["id","typeSelect","formControlName","type",1,"form-select",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","employeeSelect",1,"form-label"],["id","employeeSelect","formControlName","employeeId",1,"form-select",3,"ngClass"],["for","descriptionInput",1,"form-label"],["id","descriptionInput","formControlName","description","rows","3","placeholder","Enter a brief description...",1,"form-control",3,"ngClass"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"form-label","mb-0"],["type","button",1,"btn","btn-sm","btn-primary","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-plus"],["formArrayName","items",1,"items-container"],["class","item-row mb-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mt-4","gap-2"],["routerLink","../",1,"btn","btn-secondary","px-4","d-flex","align-items-center","gap-2",3,"disabled"],[1,"fas","fa-times"],[1,"btn","btn-primary","px-4","d-flex","align-items-center","gap-2",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[1,"fas","fa-save"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"item-row","mb-2",3,"formGroupName"],[1,"row","g-2","align-items-center"],[1,"col"],[1,"form-label",3,"for"],["formControlName","description","placeholder","Item Description",1,"form-control",3,"id","ngClass"],[1,"col-auto"],["type","number","formControlName","quantity",1,"form-control",2,"width","100px",3,"id","ngClass"],[1,"col-auto","d-flex","align-items-end"],["type","button","title","Remove Item",1,"btn","btn-sm","btn-outline-danger","mt-4","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-trash"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),d(4),n()(),i(5,"div",4)(6,"form",5),_("ngSubmit",function(){return r.onSubmit()}),i(7,"div",6)(8,"label",7),d(9,"Request Type"),n(),i(10,"select",8)(11,"option",9),d(12,"Select Request Type"),n(),m(13,Ae,3,4,"option",10),n(),m(14,Oe,2,1,"div",11),n(),i(15,"div",6)(16,"label",12),d(17,"Employee"),n(),i(18,"select",13)(19,"option",9),d(20,"Select Employee"),n(),m(21,we,2,5,"option",10),n(),m(22,Pe,2,1,"div",11),n(),i(23,"div",6)(24,"label",14),d(25,"Description"),n(),u(26,"textarea",15),m(27,Fe,2,1,"div",11),n(),i(28,"div",6)(29,"div",16)(30,"label",17),d(31,"Request Items"),n(),i(32,"button",18),_("click",function(){return r.addItem()}),u(33,"i",19),i(34,"span"),d(35,"Add Item"),n()()(),i(36,"div",20),m(37,De,17,13,"div",21),n()(),i(38,"div",22)(39,"button",23),u(40,"i",24),i(41,"span"),d(42,"Cancel"),n()(),i(43,"button",25),m(44,Be,1,0,"span",26),u(45,"i",27),i(46,"span"),d(47),n()()()()()()()),a&2&&(o(4),M("",r.isAddMode?"Create":"Edit"," Request"),o(2),s("formGroup",r.form),o(4),s("ngClass",C(15,E,r.submitted&&r.f.type.errors)),o(3),s("ngForOf",r.requestTypes),o(),s("ngIf",r.submitted&&r.f.type.errors),o(4),s("ngClass",C(17,E,r.submitted&&r.f.employeeId.errors)),o(3),s("ngForOf",r.employees),o(),s("ngIf",r.submitted&&r.f.employeeId.errors),o(4),s("ngClass",C(19,E,r.submitted&&r.f.description.errors)),o(),s("ngIf",r.submitted&&r.f.description.errors),o(10),s("ngForOf",r.items.controls),o(2),s("disabled",r.loading),o(4),s("disabled",r.loading),o(),s("ngIf",r.loading),o(3),v(r.isAddMode?"Create Request":"Update Request"))},dependencies:[w,T,P,W,ne,re,H,X,ie,J,K,Y,te,Z,ee,F,R],styles:[".items-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:1rem;border:1px solid #dee2e6;border-radius:.25rem;background-color:#f8f9fa}.item-row[_ngcontent-%COMP%]{background-color:#fff;padding:.5rem;border-radius:.25rem;border:1px solid #dee2e6;transition:box-shadow .2s,background .2s}.item-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;box-shadow:0 2px 8px #0000000f}.form-label[_ngcontent-%COMP%]{font-weight:500}.btn-danger[_ngcontent-%COMP%], .btn-outline-danger[_ngcontent-%COMP%]{padding:.25rem .5rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{min-width:100px;font-weight:500}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd26}.card[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #e3e6ea}.card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e3e6ea;padding:1.25rem 2rem .5rem}.card-body[_ngcontent-%COMP%]{padding:2rem}.mt-4[_ngcontent-%COMP%]{margin-top:2rem!important}.gap-1[_ngcontent-%COMP%]{gap:.25rem}.gap-2[_ngcontent-%COMP%]{gap:.5rem}"]})}return t})();var $e=[{path:"",component:me},{path:"add",component:D},{path:"edit/:id",component:D}],pe=(()=>{class t{static \u0275fac=function(a){return new(a||t)};static \u0275mod=A({type:t});static \u0275inj=q({imports:[L.forChild($e),L]})}return t})();var st=(()=>{class t{static \u0275fac=function(a){return new(a||t)};static \u0275mod=A({type:t});static \u0275inj=q({imports:[U,ae,pe]})}return t})();export{st as RequestsModule};
