import{c as ie,i as ne}from"./chunk-LRGH7V6E.js";import"./chunk-HPUE7TLN.js";import{a as I}from"./chunk-MLL72OG6.js";import"./chunk-O66SMQNR.js";import{$ as G,A as c,B as P,Ba as te,C as E,Ca as y,D as p,E as R,Ea as L,F as o,G as M,H as V,J as j,P as _,Q as O,W as h,X as B,Y as x,a as k,b as D,ga as U,ha as u,ia as $,j as f,ja as z,l as C,la as H,n as S,na as J,o as A,p as w,q as N,qa as K,ra as Q,s as a,sa as W,t as v,ta as X,u as l,v as d,va as Y,w as T,xa as Z,y as n,z as i,za as ee}from"./chunk-JYF5EYNH.js";var le=(e,m)=>({badge:!0,"bg-success":e,"bg-danger":m});function ce(e,m){e&1&&(n(0,"tr")(1,"td",7),c(2,"span",8),o(3," Loading accounts... "),i()())}function pe(e,m){e&1&&c(0,"span",15)}function ue(e,m){e&1&&(n(0,"span"),o(1,"Deactivate"),i())}function fe(e,m){e&1&&c(0,"span",15)}function ve(e,m){e&1&&(n(0,"span"),o(1,"Activate"),i())}function _e(e,m){if(e&1){let t=P();n(0,"tr")(1,"td"),o(2),i(),n(3,"td"),o(4),i(),n(5,"td"),o(6),i(),n(7,"td")(8,"span",9),o(9),i()(),n(10,"td",10)(11,"a",11),o(12,"Edit"),i(),n(13,"button",12),E("click",function(){let r=w(t).$implicit,b=p();return N(b.deactivateAccount(r.id))}),l(14,pe,1,0,"span",13)(15,ue,2,0,"span",5),i(),n(16,"button",14),E("click",function(){let r=w(t).$implicit,b=p();return N(b.activateAccount(r.id))}),l(17,fe,1,0,"span",13)(18,ve,2,0,"span",5),i()()()}if(e&2){let t=m.$implicit;a(2),j("",t.title," ",t.firstName," ",t.lastName,""),a(2),M(t.email),a(2),M(t.role),a(2),d("ngClass",O(19,le,t.isActive,!t.isActive)),a(),V(" ",t.isActive?"Active":"Inactive"," "),a(2),R("routerLink","edit/",t.id,""),a(2),T("disabled",t.isDeactivating),d("disabled",!t.isActive||t.isDeactivating),a(),d("ngIf",t.isDeactivating),a(),d("ngIf",!t.isDeactivating),a(),T("disabled",t.isActivating),d("disabled",t.isActive||t.isActivating),a(),d("ngIf",t.isActivating),a(),d("ngIf",!t.isActivating)}}var re=(()=>{class e{accountService;accounts=[];constructor(t){this.accountService=t}ngOnInit(){this.loadAccounts()}loadAccounts(){this.accountService.getAll().subscribe(t=>{this.accounts=t.map(s=>D(k({},s),{isDeactivating:!1,isActivating:!1}))})}deleteAccount(t){let s=this.accounts.find(r=>r.id===t);s.isDeleting=!0,this.accountService.delete(t).pipe(f()).subscribe(()=>{this.accounts=this.accounts.filter(r=>r.id!==t)})}deactivateAccount(t){let s=this.accounts.find(r=>r.id===t);s&&(s.isDeactivating=!0,this.accountService.deactivateAccount(t).pipe(f()).subscribe({next:()=>{s.isActive=!1,s.isDeactivating=!1},error:r=>{console.error("Error deactivating account:",r),s.isDeactivating=!1}}))}activateAccount(t){let s=this.accounts.find(r=>r.id===t);s&&(s.isActivating=!0,this.accountService.activateAccount(t).pipe(f()).subscribe({next:()=>{s.isActive=!0,s.isActivating=!1},error:r=>{console.error("Error activating account:",r),s.isActivating=!1}}))}static \u0275fac=function(s){return new(s||e)(v(I))};static \u0275cmp=S({type:e,selectors:[["ng-component"]],decls:22,vars:2,consts:[["routerLink","add",1,"btn","btn-sm","btn-success","mb-2"],[1,"table","table-striped"],[2,"width","25%"],[2,"width","20%"],[2,"width","15%"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","5",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"],[3,"ngClass"],[2,"white-space","nowrap"],[1,"btn","btn-sm","btn-primary","mr-1",3,"routerLink"],["aria-label","Deactivate account",1,"btn","btn-sm","btn-warning","mr-1",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],["aria-label","Activate account",1,"btn","btn-sm","btn-success",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"]],template:function(s,r){s&1&&(n(0,"h1"),o(1,"Accounts"),i(),n(2,"p"),o(3,"All accounts from secure (admin only) API endpoint:"),i(),n(4,"a",0),o(5,"Create Account"),i(),n(6,"table",1)(7,"thead")(8,"tr")(9,"th",2),o(10,"Name"),i(),n(11,"th",2),o(12,"Email"),i(),n(13,"th",3),o(14,"Role"),i(),n(15,"th",4),o(16,"Status"),i(),n(17,"th",4),o(18,"Actions"),i()()(),n(19,"tbody"),l(20,ce,4,0,"tr",5)(21,_e,19,22,"tr",6),i()()),s&2&&(a(20),d("ngIf",!r.accounts||r.accounts.length===0),a(),d("ngForOf",r.accounts))},dependencies:[h,B,x,y],encapsulation:2})}return e})();var g=e=>({"is-invalid":e});function ge(e,m){e&1&&(n(0,"h1"),o(1,"Create Account"),i())}function be(e,m){e&1&&(n(0,"h1"),o(1,"Edit Account"),i())}function Ee(e,m){e&1&&(n(0,"div"),o(1,"Title is required"),i())}function Ce(e,m){if(e&1&&(n(0,"div",25),l(1,Ee,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.title.errors.required)}}function Se(e,m){e&1&&(n(0,"div"),o(1,"First Name is required"),i())}function Ae(e,m){if(e&1&&(n(0,"div",25),l(1,Se,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.firstName.errors.required)}}function he(e,m){e&1&&(n(0,"div"),o(1,"Last Name is required"),i())}function xe(e,m){if(e&1&&(n(0,"div",25),l(1,he,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.lastName.errors.required)}}function ye(e,m){e&1&&(n(0,"div"),o(1,"Email is required"),i())}function Ie(e,m){e&1&&(n(0,"div"),o(1,"Email must be a valid email address"),i())}function we(e,m){if(e&1&&(n(0,"div",25),l(1,ye,2,0,"div",0)(2,Ie,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.email.errors.required),a(),d("ngIf",t.f.email.errors.email)}}function Ne(e,m){e&1&&(n(0,"div"),o(1,"Role is required"),i())}function Te(e,m){if(e&1&&(n(0,"div",25),l(1,Ne,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.role.errors.required)}}function Me(e,m){e&1&&(n(0,"div")(1,"h3",26),o(2,"Change Password"),i(),n(3,"p"),o(4,"Leave blank to keep the same password"),i()())}function Le(e,m){e&1&&(n(0,"div"),o(1,"Password is required"),i())}function Fe(e,m){e&1&&(n(0,"div"),o(1,"Password must be at least 6 characters"),i())}function qe(e,m){if(e&1&&(n(0,"div",25),l(1,Le,2,0,"div",0)(2,Fe,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.password.errors.required),a(),d("ngIf",t.f.password.errors.minlength)}}function ke(e,m){e&1&&(n(0,"div"),o(1,"Confirm Password is required"),i())}function De(e,m){e&1&&(n(0,"div"),o(1,"Passwords must match"),i())}function Pe(e,m){if(e&1&&(n(0,"div",25),l(1,ke,2,0,"div",0)(2,De,2,0,"div",0),i()),e&2){let t=p();a(),d("ngIf",t.f.confirmPassword.errors.required),a(),d("ngIf",t.f.confirmPassword.errors.mustMatch)}}function Re(e,m){e&1&&c(0,"span",27)}var q=(()=>{class e{formBuilder;route;router;accountService;alertService;form;id;isAddMode;loading=!1;submitted=!1;constructor(t,s,r,b,ae){this.formBuilder=t,this.route=s,this.router=r,this.accountService=b,this.alertService=ae}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({title:["",u.required],firstName:["",u.required],lastName:["",u.required],email:["",[u.required,u.email]],role:["",u.required],password:["",[u.minLength(6),this.isAddMode?u.required:u.nullValidator]],confirmPassword:[""]},{validator:ne("password","confirmPassword")}),this.isAddMode||this.accountService.getById(this.id).pipe(f()).subscribe(t=>this.form.patchValue(t))}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createAccount():this.updateAccount())}createAccount(){this.accountService.create(this.form.value).pipe(f()).subscribe({next:()=>{this.alertService.success("Account created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}updateAccount(){this.accountService.update(this.id,this.form.value).pipe(f()).subscribe({next:()=>{this.alertService.success("Update successful",{keepAfterRouteChange:!0}),this.router.navigate(["../../"],{relativeTo:this.route})},error:t=>{this.alertService.error(t),this.loading=!1}})}static \u0275fac=function(s){return new(s||e)(v(Y),v(ee),v(te),v(I),v(ie))};static \u0275cmp=S({type:e,selectors:[["ng-component"]],decls:62,vars:34,consts:[[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","col"],["formControlName","title",1,"form-control",3,"ngClass"],["value",""],["value","r"],["value","Mrs"],["value","Miss"],["value","Ms"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","col-5"],["type","text","formControlName","firstName",1,"form-control",3,"ngClass"],["type","text","formControlName","lastName",1,"form-control",3,"ngClass"],[1,"form-group","col-7"],["type","text","formControlName","email",1,"form-control",3,"ngClass"],["formControlName","role",1,"form-control",3,"ngClass"],["value","User"],["value","Admin"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],["type","password","formControlName","confirmPassword",1,"form-control",3,"ngClass"],[1,"form-group"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/admin/accounts",1,"btn","btn-link"],[1,"invalid-feedback"],[1,"pt-3"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(s,r){s&1&&(l(0,ge,2,0,"h1",0)(1,be,2,0,"h1",0),n(2,"form",1),E("ngSubmit",function(){return r.onSubmit()}),n(3,"div",2)(4,"div",3)(5,"label"),o(6,"Title"),i(),n(7,"select",4),c(8,"option",5),n(9,"option",6),o(10,"Mr"),i(),n(11,"option",7),o(12,"Mrs"),i(),n(13,"option",8),o(14,"Miss"),i(),n(15,"option",9),o(16,"Ms"),i()(),l(17,Ce,2,1,"div",10),i(),n(18,"div",11)(19,"label"),o(20,"First Name"),i(),c(21,"input",12),l(22,Ae,2,1,"div",10),i(),n(23,"div",11)(24,"label"),o(25,"Last Name"),i(),c(26,"input",13),l(27,xe,2,1,"div",10),i()(),n(28,"div",2)(29,"div",14)(30,"label"),o(31,"Email"),i(),c(32,"input",15),l(33,we,3,2,"div",10),i(),n(34,"div",3)(35,"label"),o(36,"Role"),i(),n(37,"select",16),c(38,"option",5),n(39,"option",17),o(40,"User"),i(),n(41,"option",18),o(42,"Admin"),i()(),l(43,Te,2,1,"div",10),i()(),l(44,Me,5,0,"div",0),n(45,"div",2)(46,"div",3)(47,"label"),o(48,"Password"),i(),c(49,"input",19),l(50,qe,3,2,"div",10),i(),n(51,"div",3)(52,"label"),o(53,"Confirm Password"),i(),c(54,"input",20),l(55,Pe,3,2,"div",10),i()(),n(56,"div",21)(57,"button",22),l(58,Re,1,0,"span",23),o(59," Save "),i(),n(60,"a",24),o(61,"Cancel"),i()()()),s&2&&(d("ngIf",r.isAddMode),a(),d("ngIf",!r.isAddMode),a(),d("formGroup",r.form),a(5),d("ngClass",_(20,g,r.submitted&&r.f.title.errors)),a(10),d("ngIf",r.submitted&&r.f.title.errors),a(4),d("ngClass",_(22,g,r.submitted&&r.f.firstName.errors)),a(),d("ngIf",r.submitted&&r.f.firstName.errors),a(4),d("ngClass",_(24,g,r.submitted&&r.f.lastName.errors)),a(),d("ngIf",r.submitted&&r.f.lastName.errors),a(5),d("ngClass",_(26,g,r.submitted&&r.f.email.errors)),a(),d("ngIf",r.submitted&&r.f.email.errors),a(4),d("ngClass",_(28,g,r.submitted&&r.f.role.errors)),a(6),d("ngIf",r.submitted&&r.f.role.errors),a(),d("ngIf",!r.isAddMode),a(5),d("ngClass",_(30,g,r.submitted&&r.f.password.errors)),a(),d("ngIf",r.submitted&&r.f.password.errors),a(4),d("ngClass",_(32,g,r.submitted&&r.f.confirmPassword.errors)),a(),d("ngIf",r.submitted&&r.f.confirmPassword.errors),a(2),d("disabled",r.loading),a(),d("ngIf",r.loading))},dependencies:[h,x,H,W,X,U,Q,$,z,J,K,y],encapsulation:2})}return e})();var Ve=[{path:"",component:re},{path:"add",component:q},{path:"edit/: id",component:q}],oe=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275mod=A({type:e});static \u0275inj=C({imports:[L.forChild(Ve),L]})}return e})();var rt=(()=>{class e{static \u0275fac=function(s){return new(s||e)};static \u0275mod=A({type:e});static \u0275inj=C({imports:[G,Z,oe]})}return e})();export{rt as AccountsModule};
